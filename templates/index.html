<!DOCTYPE html>
<html>
<meta name="viewport" content="device-width, initial-scale=1.0" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.
css">
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
<script src="https://open.spotify.com/embed-podcast/iframe-api/v1" async></script>

<script>
  $( function() {

    var selectedSong = ''

    var songs = {{songs|safe}}
    var answer = {{song|safe}}
    var random_selection = {{uri|safe}}
    var youtube_url = {{youtube|safe}}

    console.log(youtube_url)

    var guesses = 0;
    var doneGuessing = false;

    $( "#songtag" ).autocomplete({
      source: function(request, response) {
        var results = $.ui.autocomplete.filter(songs, request.term);
        response(results.slice(0, 10));
      },
      select: function(event, ui) {
        selectedSong = ui.item.value;
      }
    });

    $("#button").click(function() {
      if(!doneGuessing) {
        guesses++;
        if(selectedSong == answer) {
          alert("You have guessed the song!")
          doneGuessing = true;
        } else if(selectedSong != '') {
          if(guesses < 6)
            alert("Incorrect guess. You have " + (6 - guesses) + " remaining guesses");
          else
            alert("Incorrect guess. The answer was " + answer);
        }

        if(guesses >= 6)
          doneGuessing = true;
      }
    });

    $(".content .value").html(answer);

    $(".player").attr("src", "https://open.spotify.com/embed/track/" + random_selection + "#0:00?utm_source=generator").hide();

    $(".youtube_player").attr("src", "https://www.youtube.com/embed/" + youtube_url)
  });
</script>

<div class="ui-widget">
    <h3>Enter Song Title or Artist</h3>
        <input id="songtag">

    <div class="content">
      Selected song: <span class='value'></span>
    </div>

    <div id="button"> Submit </div>

    <iframe class="player" style="border-radius:12px" width="40%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

    <iframe class="youtube_player" width="200" height="200" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</html>